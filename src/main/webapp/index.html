<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<title>LandingPage</title>
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/bootstrap.css">
  <link rel="stylesheet" href="css/style.css">
  <link href="css/bootstrap-datepicker.css" rel="stylesheet" />
  
  <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300" rel='stylesheet' type='text/css'>
  
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
  <script>
    var confirmOnExit = true;
	//show the player and open the create account dialog after 7 seconds
    function showElements() {
      setTimeout(function(){ 
          //var x = document.getElementById("loading").style.display = "none";
          document.getElementById("screen").style.display = "block";
          document.getElementById("loading").style.position = "absolute";
       }, 1500);

      setTimeout(function () {
    	  openCreateAccountDialog();

      },7000);
    }

    function openCreateAccountDialog() {
    	document.getElementById("CreateAccount").style.display = "flex";
        document.getElementById("mask").style.display = "block";
        document.getElementById("circularG").style.display = "none";
        document.getElementById("loadSpan").style.display = "none";
        document.getElementById("contentBar").style.display = "none";
        document.getElementById("loading").style.display = "none";

        document.getElementById("w8").style.display = "none";
    }
       
    //prevent to leave the page before ends the inscription
    window.onbeforeunload = confirmExit;
    function confirmExit() {
    	if (confirmOnExit) {
        	return "You have attempted to leave this page. Are you sure?";
        }
    }
    
	//Validate the create Account data and open the Verification page
    function openVerificationPage() {
    	document.getElementById("LandingPage").style.display = "none";
	    document.getElementById("VerificationPage").style.display = "flex";
	    document.getElementById("body").className = "whiteBg";
    }
    function validatedCreateAccount() {
    	//Get data from url 
    	
    	//url format ?aff=affiliateNumber&country=countryNumber&theme=themeCode&titleMovie=movieTitle
    	urlParams = parseURLParams(window.location.href);    	
    	
    	var affiliateCode = urlParams.aff[0];
    	var countryCode = urlParams.country[0];
    	var email = document.getElementById("email");
    	var psw = document.getElementById("psw");
    	var psw2 = document.getElementById("psw2");
    	
    	var okEmail = false;
    	var okPsw = false;
    	var okPsw2 = false;
    	var okPswEquals = false;
    	
    	//not allow empty fields
    	if(email.value === undefined || email.value == "") {
    		email.className = "error";
    		email.title = "Please enter an email";
    	} else if(!validEmail(email.value)){  //validate entered email
    		email.className = "error";
    		email.title = "Please enter a valid email";
    	} else { //no email errors
    		email.className = "";
    		email.title = "";
    		okEmail = true;
    	}  
    	if(psw.value === undefined || psw.value == "") {
    		psw.className = "error";
    		psw.title = "Please enter a password";
    	} else {
    		psw.className = "";
    		psw.title = "";
    		okPsw = true;
    	}  
    	if(psw2.value === undefined || psw2.value == "") {
    		psw2.className = "error";
    		psw2.title = "Please confirm your password";
    	} else {
    		psw2.className = "";
    		psw2.title = "";
    		okPsw2 = true;
    	}  
    	
    	if(psw.value === psw2.value) { //validate password and confirm password are equals
    		okPswEquals = true;
    	} else {
    		psw.className = "error";
    		psw2.className = "error";
    		psw.title = "password and confirm password are not the same, please type again";
    		psw2.title = "password and confirm password are not the same, please type again";
    	}
    	
    	if(okEmail && okPsw && okPsw2 && okPswEquals) {
    		
    		data = {email: email.value, pw: psw.value, pwConfirm: psw2.value, affiliate: affiliateCode, country: countryCode};
    		$.ajax({
				url: "rest/client/register",
    			type: "POST",
    			dataType: "json", // expected format for response
    			contentType: "application/x-www-form-urlencoded; charset=UTF-8", 
				data : data,
				success : function(response) { 
					if(response.status == 15){
						openVerificationPage();
					}
					else {
						alert(response.message);
					}
				},
				error : function(response, status, error) {
					alert(response.message);
				}
			});
    	}
	}
    function validEmail(mail) {
    	 var re = /[A-z0-9._%+-]+@[A-z0-9.-]+.[A-z]{2,4}/;
    	    return re.test(mail);
    }
    
    function verifyAccount() {
      document.getElementById("VerificationPage").style.display = "none";
      document.getElementById("page3").style.display = "flex";
      document.getElementById("body").className = "";
      setTimeout(function(){
        window.open ('movies.html','_self',false)
        confirmOnExit = false;
      },2000);

    }
	
    //start the count down timer
    window.onload = function() {  
    	urlParams = parseURLParams(window.location.href);  
    	var title = urlParams.titleMovie[0];
    	document.getElementById("movieTitle").innerHTML = title;
    	var display = document.querySelector('#time'),
	    timer = new CountDownTimer(480);
	    timer.onTick(format).onTick(restart).start();
	
	    function restart() {
	    	if (this.expired()) {
	        	setTimeout(function() { timer.start(); }, 1000);
	        }
	    }

	    function format(minutes, seconds) {
	      minutes = minutes < 10 ? "0" + minutes : minutes;
	      seconds = seconds < 10 ? "0" + seconds : seconds;
	      display.textContent = minutes + ':' + seconds;
	    }
  	};

  	function parseURLParams(url) {
  	    var queryStart = url.indexOf("?") + 1,
  	        queryEnd   = url.indexOf("#") + 1 || url.length + 1,
  	        query = url.slice(queryStart, queryEnd - 1),
  	        pairs = query.replace(/\+/g, " ").split("&"),
  	        parms = {}, i, n, v, nv;

  	    if (query === url || query === "") {
  	        return;
  	    }

  	    for (i = 0; i < pairs.length; i++) {
  	        nv = pairs[i].split("=");
  	        n = decodeURIComponent(nv[0]);
  	        v = decodeURIComponent(nv[1]);

  	        if (!parms.hasOwnProperty(n)) {
  	            parms[n] = [];
  	        }

  	        parms[n].push(nv.length === 2 ? v : null);
  	    }
  	    return parms;
  	}
  </script>
</head>
<body onload="showElements()" id="body">
  <script type="text/x-handlebars">
  <div id="LandingPage">
    <div id="content">
      <div id="header" onclick="openCreateAccountDialog()">
        <div id="titles">
          <div class="title"><div id="logo"></div><span>start watching movies instantly!</span></div>
          <div class="subtitle" id="movieTitle">HD Steaming(720) "THE BEST & THE BEAST"</div>
        </div>
        <div class="download">
          <button class="greenBtn">
            <span class="title">DOWNLOAD</span>
            <span class="subtitle">TO YOUR COMPUTER</span>
          </button>
          <div id="stars"><i class="material-icons">star</i><i class="material-icons">star</i><i class="material-icons">star</i><i class="material-icons">star</i><i class="material-icons">star</i></div>
        </div>
      </div>
      <div class="playerContainer">
        <div class="width ratio16-9">
          <div class="content">
            <div class="loading" id="loading">
              <div class="windows8" id="w8">
                <div class="wBall" id="wBall_1">
                  <div class="wInnerBall"></div>
                </div>
                <div class="wBall" id="wBall_2">
                  <div class="wInnerBall"></div>
                </div>
                <div class="wBall" id="wBall_3">
                  <div class="wInnerBall"></div>
                </div>
                <div class="wBall" id="wBall_4">
                  <div class="wInnerBall"></div>
                </div>
                <div class="wBall" id="wBall_5">
                  <div class="wInnerBall"></div>
                </div>
              </div>
            </div>
            <div class="screen" id="screen">
              <div class="movie"></div>
              <div class="movieTimer" onclick="openCreateAccountDialog()">
                <div id="circularG">
                  <div id="circularG_1" class="circularG"></div>
                  <div id="circularG_2" class="circularG"></div>
                  <div id="circularG_3" class="circularG"></div>
                  <div id="circularG_4" class="circularG"></div>
                  <div id="circularG_5" class="circularG"></div>
                  <div id="circularG_6" class="circularG"></div>
                  <div id="circularG_7" class="circularG"></div>
                  <div id="circularG_8" class="circularG"></div>
                </div><span id="loadSpan">Loading...</span>
                <div class="contentBar fullwidth" id="contentBar">
                  <span class="expand "></span>
                  <span class="expand expandRed"></span>
                </div>
              </div>
            </div>
            <div class="controllers" onclick="openCreateAccountDialog()"></div>
          </div>
        </div>
      </div>
      <div id="languages">
        
      </div>
      
      <div class="mask" id="mask"></div>
      <div id="CreateAccount"> 
      	<div class="registrationWrapper">
        	<div id="registration">
          		<p>Only registered Friends can watch all the movies!</p>
          		<p class="enlargedText">you must create a <span class="green">FREE</span> account to <span class="green">STREAM</span> this movie</p>
          		<input type="email" id="email" placeholder="E-mail" >
          		<input type="password" id="psw" maxlength="12" placeholder="Password">
          		<input type="Password" id="psw2" maxlength="12" placeholder="Confirm Password">
          		<button class="greenBtn" onclick="validatedCreateAccount()">CREATE MY FREE ACCOUNT NOW</button>
        	</div>
        </div>
      </div>
    </div>
  </div>
  <div id="VerificationPage">
    <div id="content">
      <div id="header" class="grayBg">
        <div id="title" class="title"></div>
      </div>
      <div class="verificationContainer">
        <div class="explanation">
          <div class="title">Why do we ask you for your billing information?</div>
          <p>Because our library is only licensed to distribute our content to certain countries, we ask that you provide your mailling address by providing us with a valid credit card number. <b>NO CHARGES GUARANTEED</b>. No charges will appear on your credit card statement unless you upgrade to a Premium Membership or make a purchase.</p>
          <hr>
          <ul><li>Click and watch</li>
          <li>Steam movies in HD</li>
          <li>Watch on any device</li>
          <li>Hassle Free Cancellation</li>
          <li>Free of charge</li></ul>
          <hr>
          <div class="title">Privacy Guaranteed</div>
          <p>In order to keep your personal information private, we use encryption security tehnology. Our site employs <b>Secure Sockets Layering (SSL)</b> to encript your personal information such as credit card number, name, and address before it travels over the internet. Your data is encrypted and password-protected to make sure no one ever sees your personal information!!! </p>
          <div class="title">No Hidden Fees</div>
          <p>We always provide our members with a detailed purchase history in order for them to know exactly what they are paying for. Your payment method information is requiered to future purchases only. <b>NO CHARGES</b> will appear on your credit card statement unless you upgrade to a Premium Membership or make a purchase. By creating an account, you agree our <span class="underlined">Terms & Conditions</span></p>
        </div>
        <div class="creditCardForm">
          <div class="timer">Our special offer will be available only in the next <span id="time"></span>
          </div>
          <div class="verificationForm">
            <span class="title">Account Verification</span>
            <div class="subtitle">
              <img src="images/MF_pre-reg_verification-VBlue1.png" alt=""><span class="little">Normal memebership</span>
              <div class="stars"><i class="material-icons">star</i><i class="material-icons">star</i><i class="material-icons">star</i><i class="material-icons">star</i><i class="material-icons">star</i></div> <div><span class="free">FREE</span><span class="price">$0.00</span></div></div>
              <table class="fields">
                <tr>
                  <td>First Name</td>
                  <td class="inputField"><input type="text" id="FName" name="FName" minlength="2" maxlength="30" required="true"></td>
                  <td><div class="okIcon"></div></td>
                </tr>
                <tr>
                  <td>Last Name</td>
                  <td class="inputField"><input type="text" id="LName" name="LName"></td>
                  <td><div class="okIcon"></div></td>
                </tr>
                <tr>
                  <td>Country</td>
                  <td class="inputField">{{view Ember.Select 
                      contentBinding="App.CountryController" 
                      selectionBinding="App.CountrySelectedController.name" 
                      optionLabelPath="content.name" 
                      optionValuePath="content.name"}}</td>
                  <td></td>
                </tr>
                <tr>
                  <td>Zip/postal</td>
                  <td class="inputField"><input type="text" id="Zip" name="Zip"></td>
                  <td></td>
                </tr>
                <tr>
                  <td colspan="2"><div class="cardIcons"></div></td>
                </tr>
                <tr>
                  <td>Credit Card</td>
                  <td class="inputField"><input type="text" id="CNumber" name="CNumber"></td>
                  <td></td>
                </tr>
                <tr>
                  <td>Expiry Date</td>
                  <td id="ExpDT" class="inputField">{{view Ember.Select 
                      contentBinding="App.MonthsController" 
                      optionLabelPath="content.name" 
                      optionValuePath="content.id"}}
                      {{view Ember.Select 
                      contentBinding="App.YearsController" 
                      optionLabelPath="content.name" 
                      optionValuePath="content.id"}}
                  <td></td>
                </tr>
                <tr>
                  <td ><span>CVV</span><br><span class="info"><a>What is CVV?</a></span></td>
                  <td class="inputField smallInput"><input class="smallInput" type="text"></td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td class="inputField"><button class="greenBtn" onclick="verifyAccount()">VERIFY MY ACCOUNT</button></td>
                  <td></td>
                </tr>
              </table>
              </div>
          </div>
        </div>
        <div class="footer"><div class="footerBody"></div></div>
      </div>
      
    </div>

  </div>

  <div id="page3">
  <div class="container">
    <div class="logo"></div>
    <div class="tnx">Thank you.
    <p>a verification email has been send to you, <br> you will be redirect to the movie library now. Enjoy</p></div>
  </div>
  </div>

  </script>


    <script src="js/bower_components/jquery/dist/jquery.min.js"></script>
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
	<script src="js/bower_components/handlebars/handlebars.min.js"></script>
	<script src="js/bower_components/ember/ember.min.js"></script>
	<script src="js/ember-data.min.js"></script>
	<script src="js/ajaxfileupload.js"></script>
	<script src="js/jquery-ui.min.js"></script>
	<script type="text/javascript" src="js/fontsmoothie.min.js"></script>
	<script src="js/util.js"></script>
	<script src="js/i18n/grid.locale-en.js" type="text/javascript"></script>
	<script type='text/javascript'
		src="http://cdnjs.cloudflare.com/ajax/libs/jqgrid/4.6.0/js/jquery.jqGrid.min.js"></script>
	  <script src="js/showdown.js"></script>
	  <script src="js/moment.js"></script>
	  <script src="js/countdowntimer.js"></script>
	  <script src="js/app.js"></script>


</body>
</html>
